select TRAN_DATE, count(1)
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'C'
  and BASE_ACCT_NO = '358001201110002099'
  and TRAN_DATE >= '20250101'
group by TRAN_DATE;

select BASE_ACCT_NO, CR_DR_MAINT_IND, TRAN_AMT, NARRATIVE, NARRATIVE_CODE, TRAN_DATE
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'C'
  and BASE_ACCT_NO = '358001201110002099'
  and NARRATIVE_CODE = '303'
  and TRAN_DATE >= '20250101'
order by TRAN_DATE desc;


-- 查看季度结息计提
select *
from INCREMENT_INTEREST_DETAIL
order by REAL_DEPOSIT_START_DATE desc;

-- 查看流水中是否有相关的流水
select *
from HX_WATER_DETAIL
where TRAN_AMT = '24050.00';

-- 看某一次季度计提的所有存单总金额
select ACCRUED_END_DATE, sum(THIS_ACCRUED_INTEREST)
from INCREMENT_INTEREST_DETAIL
group by ACCRUED_END_DATE
order by ACCRUED_END_DATE desc;
-- 20250320 755186522.91
--          755186522.91

-- 查看流水中的总金额
select sum(TRAN_AMT)
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'C'
  and BASE_ACCT_NO = '358001201110002099'
  and TRAN_DATE between '20250301' and '20250331'
  and NARRATIVE_CODE != '303';

select BASE_ACCT_NO, CR_DR_MAINT_IND, TRAN_AMT, NARRATIVE, NARRATIVE_CODE, TRAN_DATE, TRAN_NOTE
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'C'
  and BASE_ACCT_NO = '358001201110002099'
  and TRAN_DATE between '20250301' and '20250331'
  and NARRATIVE_CODE != '303';

select BASE_ACCT_NO, CR_DR_MAINT_IND, TRAN_AMT, NARRATIVE, NARRATIVE_CODE, TRAN_DATE, TRAN_NOTE
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'C'
  and BASE_ACCT_NO = '358001201110002099'
  and TRAN_DATE between '20250301' and '20250331'
  and NARRATIVE_CODE = '303';

select sum(TRAN_AMT)
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'C'
  and BASE_ACCT_NO = '358001201110002099'
  and TRAN_DATE between '20250301' and '20250331'
  and NARRATIVE_CODE = '#'; -- 556053662.8


select *
from HX_WATER_DETAIL
where TRAN_AMT = '767925065.75';

select BASE_ACCT_NO, CR_DR_MAINT_IND, TRAN_AMT, NARRATIVE, NARRATIVE_CODE, TRAN_DATE, TRAN_NOTE
from HX_WATER_DETAIL
where CR_DR_MAINT_IND = 'D'
  and BASE_ACCT_NO = '358001201110002099'
  and TRAN_DATE between '20250301' and '20250331';


select *
from HX_WATER_DETAIL
where NARRATIVE = '利息'
  and BASE_ACCT_NO = '358001201110002099';

-- 利息支出 利转本
select *
from HX_WATER_DETAIL
where BASE_ACCT_NO = '358001201110002099'
  and CR_DR_MAINT_IND = 'D';

-- 利息收入
select *
from HX_WATER_DETAIL
where BASE_ACCT_NO = '358001201110002099'
  and CR_DR_MAINT_IND = 'C';


-- 每年的利息收入、支出、当年净额
SELECT
    SUBSTR(t.TRAN_DATE, 1, 4) AS YEAR_NO,
    SUM(CASE WHEN t.CR_DR_MAINT_IND = 'C' THEN t.TRAN_AMT ELSE 0 END) AS INCOME_AMT,
    SUM(CASE WHEN t.CR_DR_MAINT_IND = 'D' THEN t.TRAN_AMT ELSE 0 END) AS EXPENSE_AMT,
    SUM(CASE
            WHEN t.CR_DR_MAINT_IND = 'C' THEN t.TRAN_AMT
            WHEN t.CR_DR_MAINT_IND = 'D' THEN -t.TRAN_AMT
            ELSE 0
        END) AS NET_AMT
FROM HX_WATER_DETAIL t
WHERE t.BASE_ACCT_NO = '358001201110002099'
GROUP BY SUBSTR(t.TRAN_DATE, 1, 4)
ORDER BY YEAR_NO;
-- 累计利息收入（历史全部）
SELECT
    SUM(CASE
            WHEN t.CR_DR_MAINT_IND = 'C' THEN t.TRAN_AMT
            ELSE 0
        END) AS TOTAL_INTEREST_INCOME
FROM HX_WATER_DETAIL t
WHERE t.BASE_ACCT_NO = '358001201110002099';
-- 今年年度累计利息收入（本年度，从 1 月 1 日到今天）
SELECT
    SUM(CASE
            WHEN t.CR_DR_MAINT_IND = 'C' THEN t.TRAN_AMT
            ELSE 0
        END) AS YTD_INTEREST_INCOME
FROM HX_WATER_DETAIL t
WHERE t.BASE_ACCT_NO = '358001201110002099'
  AND SUBSTR(t.TRAN_DATE, 1, 4) = TO_CHAR(SYSDATE, 'yyyy'); -- 2337999578.14 2337999578.14
-- 本年度利息支出（今年发生的利息支出）
SELECT
    SUM(CASE
            WHEN t.CR_DR_MAINT_IND = 'D' THEN t.TRAN_AMT
            ELSE 0
        END) AS YTD_INTEREST_EXPENSE
FROM HX_WATER_DETAIL t
WHERE t.BASE_ACCT_NO = '358001201110002099'
  AND SUBSTR(t.TRAN_DATE, 1, 4) = TO_CHAR(SYSDATE, 'yyyy'); -- 3280787825.28 3280787825.28
